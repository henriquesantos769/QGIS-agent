{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="csrf-token" content="{{ csrf_token }}">
  <title>Agente QGIS | Automa√ß√£o de Memoriais</title>
  <link rel="stylesheet" href="{% static 'automacoes_memoriais/css/style.css' %}">
</head>

<body onpageshow="if (event.persisted || performance.getEntriesByType('navigation')[0]?.type === 'back_forward') location.reload();">

  <div class="wrap">
    <div class="card">

      <h1>Gerador de Memoriais</h1>

      <p class="subtitle">
        Envie um <strong>projeto QGIS compactado (.zip)</strong> contendo o arquivo
        <code>.qgs</code> ou <code>.qgz</code> e suas pastas de camadas
        (<em>quadras, ruas, ortofoto, etc.</em>) para gerar os memoriais automaticamente.
      </p>

      <!-- =========================
           UPLOAD DO PROJETO QGIS (ZIP)
      ========================== -->
      <div class="upload-area">
        <label class="uploader" id="dropzone-qgis">
          <input
            id="fileInputProject"
            type="file"
            accept=".zip"
          />
          <div>
            <strong>Projeto QGIS (.zip)</strong>
            <div class="hint">
              Deve conter o .qgs/.qgz e as pastas das camadas
            </div>
          </div>
        </label>
      </div>

      <!-- =========================
           CONFIGURA√á√ÉO DAS CAMADAS
      ========================== -->
      <div class="config-area">
        <h3>Configura√ß√£o das Camadas</h3>

        <div class="field">
          <label for="layerLotes">Camada de Lotes (obrigat√≥ria)</label>
          <input
            id="layerLotes"
            type="text"
            placeholder="Ex: lotes"
            value="final_gpkg"
          />
        </div>

        <div class="field">
          <label for="layerQuadras">Camada de Quadras (opcional)</label>
          <input
            id="layerQuadras"
            type="text"
            placeholder="Ex: quadras"
            value="quadras_m2s"
          />
          <div class="hint">
            Se n√£o informada, as quadras ser√£o geradas automaticamente.
          </div>
        </div>

        <div class="field">
          <label for="layerRuas">Camada de Ruas (opcional)</label>
          <input
            id="layerRuas"
            type="text"
            placeholder="Ex: ruas"
            value="ruas_osm_detalhadas"
          />
          <div class="hint">
            Se n√£o informada, o sistema pode usar OpenStreetMap ou a frente dos lotes.
          </div>
        </div>
      </div>

      <!-- =========================
           √ÅREA DE PROGRESSO
      ========================== -->
      <div class="progress-area" id="progressArea">
        <div class="progress-card">

          <div class="badge">
            <span id="stageChip">Etapa 1</span>
          </div>

          <div style="display:flex; align-items:center; justify-content:space-between; margin:6px 0 8px;">
            <div
              id="stageTitle"
              style="font-size:18px; font-weight:700;"
            >
              Preparando ambiente‚Ä¶
            </div>
            <div class="ticker" id="percentLabel">0%</div>
          </div>

          <div class="bar">
            <div id="barFill"></div>
          </div>

          <div class="mini" id="detailLine">
            Aguardando in√≠cio‚Ä¶
          </div>

          <div class="steps" id="stepsList" style="margin-top:14px;"></div>

          <!-- =========================
               BOT√ïES
          ========================== -->
          <div class="footer">

            <button
              class="btn primary start-btn"
              id="startBtn"
              type="button"
              disabled
            >
              ‚ñ∂Ô∏è Gerar Memoriais
            </button>

            <button
              class="btn download"
              id="downloadMemoriais"
              style="display:none;"
              type="button"
            >
              ‚¨áÔ∏è Baixar Memoriais
            </button>

            <button
              class="btn ghost"
              id="resetBtn"
              style="display:none;"
              type="button"
            >
              üîÑ Reiniciar
            </button>

          </div>

        </div>
      </div>

    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast">Processo iniciado!</div>

  <script src="{% static 'automacoes_memoriais/js/main.js' %}"></script>

</body>
</html>
