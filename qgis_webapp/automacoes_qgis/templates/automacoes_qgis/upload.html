{% extends "automacoes_qgis/base.html" %}

{% block title %}Automação QGIS - Upload DXF{% endblock %}

{% block content %}
<div class="container mt-4">
  <h2>📁 Enviar arquivo DXF para processamento</h2>
  <p class="text-muted">O sistema executará automaticamente todas as etapas de automação do PyQGIS.</p>

  <form method="POST" enctype="multipart/form-data" class="mt-3">
    {% csrf_token %}
    <div class="mb-3">
      <input type="file" name="arquivo" accept=".dxf" class="form-control" required>
    </div>
    <button type="submit" class="btn btn-primary">🚀 Iniciar processamento</button>
  </form>

  {% if mensagem_final %}
    <div class="alert alert-info mt-4">{{ mensagem_final }}</div>
  {% endif %}

  {% if progresso %}
  <div class="card mt-4 shadow-sm">
    <div class="card-header bg-light fw-bold">📊 Etapas do processamento</div>
    <ul class="list-group list-group-flush">
      {% for passo in progresso %}
        {% if "✅" in passo %}
          <li class="list-group-item text-success fw-semibold">{{ passo }}</li>
        {% elif "❌" in passo %}
          <li class="list-group-item text-danger fw-semibold">{{ passo }}</li>
        {% else %}
          <li class="list-group-item">{{ passo }}</li>
        {% endif %}
      {% endfor %}
    </ul>
  </div>

  {% if "concluído" in mensagem_final %}
    <div class="mt-4">
      <a href="{% url 'converter_para_qgis' %}" class="btn btn-success">💾 Salvar como projeto QGIS</a>
      <a href="{% url 'visualizar_shp' %}" class="btn btn-info ms-2">👁️ Visualizar shapefiles</a>
    </div>
  {% endif %}
  {% endif %}
</div>
{% endblock %}
